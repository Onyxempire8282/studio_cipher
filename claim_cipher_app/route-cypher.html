<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Route Cipher - Claim Cipher</title>
    <link rel="stylesheet" href="styles/cipher-core.css">
    <link rel="stylesheet" href="styles/main.css">
    <link rel="stylesheet" href="styles/route-optimizer.css">
    <!-- üé® UNIFIED VISUAL CONSISTENCY FIX -->
    <link rel="stylesheet" href="styles/visual-consistency-fix.css">
    <!-- üåü UNIVERSAL GLASSMORPHISM DESIGN SYSTEM -->
    <link rel="stylesheet" href="styles/glassmorphism-universal.css">
    <!-- üî• GLASSMORPHISM FORCE OVERRIDE -->
    <link rel="stylesheet" href="styles/glassmorphism-force-override.css">
    <!--  UNIVERSAL HEADER & LAYOUT FIXES -->`n    <link rel="stylesheet" href="styles/universal-header-fixes.css">`n</head>
<body class="route-page">
    <nav class="top-nav">
        <div class="nav-brand">
            <h1>üé§ Claim Cipher</h1>
            <span class="tagline">No Matter What</span>
        </div>
        <div class="nav-links">
            <a href="command-center.html">Dashboard</a>
            <a href="mileage-cypher.html">Mileage</a>
            <a href="route-cypher.html" class="active">Routes</a>
            <a href="settings-booth.html">Settings</a>
        </div>
    </nav>

    <main class="route-optimizer-main">
        <div class="page-header">
            <h1>üó∫Ô∏è Route Cipher</h1>
            <p>Optimize your route like a pro - fastest path, smart splitting</p>
        </div>

        <div class="route-optimizer-container">
            <!-- Input Section -->
            <div class="route-inputs">
                <div class="input-group">
                    <label for="startLocation">üéØ Starting Location</label>
                    <input type="text" id="startLocation" placeholder="Enter starting address or coordinates">
                </div>

                <div class="destinations-section">
                    <div class="section-header">
                        <label>üìç Destinations</label>
                        <button id="addDestination" class="add-btn">+ Add Stop</button>
                    </div>
                    <div id="destinationsList">
                        <div class="destination-input">
                            <input type="text" placeholder="Enter destination address">
                            <button class="remove-btn" onclick="removeDestination(this)">√ó</button>
                        </div>
                    </div>
                </div>

                <!-- Settings -->
                <div class="route-settings">
                    <div class="setting-row">
                        <label class="toggle-label">
                            <input type="checkbox" id="optimizeEnabled" checked>
                            <span class="toggle-slider"></span>
                            Route Optimization
                        </label>
                    </div>
                    
                    <div class="setting-row">
                        <label class="toggle-label">
                            <input type="checkbox" id="splitEnabled" checked>
                            <span class="toggle-slider"></span>
                            Day Splitting
                        </label>
                    </div>
                    
                    <div class="setting-row">
                        <label for="maxLegMiles">Max Miles Per Leg:</label>
                        <input type="number" id="maxLegMiles" value="50" min="1" max="500">
                        <span>miles</span>
                    </div>
                </div>

                <button id="optimizeRoute" class="optimize-btn">üöÄ Optimize Route</button>
            </div>

            <!-- Results Section -->
            <div class="route-results" id="routeResults" style="display: none;">
                <h3>üéØ Optimized Route</h3>
                <div id="routeOutput"></div>
                <div class="route-actions">
                    <button id="copyRoute" class="copy-btn">üìã Copy Route</button>
                    <button id="exportMiles" class="export-btn">üìä Export to Mileage Calculator</button>
                </div>
            </div>

            <!-- Map Container -->
            <div class="map-container">
                <div id="routeMap"></div>
            </div>
        </div>

        <!-- Loading Overlay -->
        <div id="loadingOverlay" class="loading-overlay" style="display: none;">
            <div class="loading-content">
                <div class="spinner"></div>
                <p>üéµ Calculating optimal route...</p>
            </div>
        </div>

        <!-- Error Display -->
        <div id="errorDisplay" class="error-display" style="display: none;">
            <p id="errorMessage"></p>
            <button onclick="hideError()">√ó</button>
        </div>
    </main>

    <!-- Google Maps API -->
    <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDR51CGOXEyVz8Dy-6hU7kdaqbq8-CTkBs&libraries=places,geometry&callback=initRouteOptimizer"></script>
    <script src="scripts/route-optimizer.js"></script>

    <!-- Security Agent: Google Maps API Script -->
    <script>
        // Security Agent: Global callback function
        function initRouteOptimizer() {
            console.log('üîí Security Agent: Google Maps API loaded, initializing...');
            
            try {
                if (typeof RouteOptimizer !== 'undefined') {
                    window.routeOptimizer = new RouteOptimizer();
                    
                    // Initialize Google Maps
                    if (window.routeOptimizer && typeof google !== 'undefined') {
                        const mapContainer = document.getElementById('routeMap');
                        if (mapContainer) {
                            window.routeOptimizer.map = new google.maps.Map(mapContainer, {
                                zoom: 10,
                                center: { lat: 40.7128, lng: -74.0060 },
                                mapTypeId: google.maps.MapTypeId.ROADMAP
                            });
                            
                            window.routeOptimizer.directionsService = new google.maps.DirectionsService();
                            window.routeOptimizer.directionsRenderer = new google.maps.DirectionsRenderer({
                                draggable: true,
                                panel: document.getElementById('directionsPanel')
                            });
                            window.routeOptimizer.geocoder = new google.maps.Geocoder();
                            
                            window.routeOptimizer.directionsRenderer.setMap(window.routeOptimizer.map);
                            
                            console.log('üîí Security Agent: Google Maps fully initialized!');
                        } else {
                            console.error('üîí Security Agent: Map container #routeMap not found');
                        }
                    }
                }
            } catch (error) {
                console.error('üîí Security Agent: Initialization error:', error);
            }
        }
        
        // Security Agent: Error handler for API failures
        function gm_authFailure() {
            console.error('üîí Security Agent: Google Maps authentication failed');
            document.getElementById('errorMessage').textContent = 'Google Maps failed to load. Check API key.';
            document.getElementById('errorDisplay').style.display = 'block';
        }
    </script>
    
    <!-- Security Agent: Google Maps API with callback -->
    <script async defer 
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDR51CGOXEyVz8Dy-6hU7kdaqbq8-CTkBs&libraries=places,geometry&callback=initRouteOptimizer">
    </script>
    
    <script src="scripts/route-optimizer.js"></script>
</body>
</html>


